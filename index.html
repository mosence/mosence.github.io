<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>MoSence</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="MoSence">
<meta property="og:url" content="https://mosence.github.io/index.html">
<meta property="og:site_name" content="MoSence">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="MoSence">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="MoSence" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.0.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">MoSence</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://mosence.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/22/hello-world/" class="article-date">
  <time class="dt-published" datetime="2023-11-22T02:15:29.087Z" itemprop="datePublished">2023-11-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/22/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mosence.github.io/2023/11/22/hello-world/" data-id="clp952vdo0005m4k5abwd1njd" data-title="Hello World" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-文档-如何才能做到代码文档一体" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/11/22/%E6%96%87%E6%A1%A3-%E5%A6%82%E4%BD%95%E6%89%8D%E8%83%BD%E5%81%9A%E5%88%B0%E4%BB%A3%E7%A0%81%E6%96%87%E6%A1%A3%E4%B8%80%E4%BD%93/" class="article-date">
  <time class="dt-published" datetime="2023-11-22T01:49:32.000Z" itemprop="datePublished">2023-11-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/11/22/%E6%96%87%E6%A1%A3-%E5%A6%82%E4%BD%95%E6%89%8D%E8%83%BD%E5%81%9A%E5%88%B0%E4%BB%A3%E7%A0%81%E6%96%87%E6%A1%A3%E4%B8%80%E4%BD%93/">文档-如何才能做到代码文档一体</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>不知道 JetBrain WriteSize 能否？后续试试推进看看。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mosence.github.io/2023/11/22/%E6%96%87%E6%A1%A3-%E5%A6%82%E4%BD%95%E6%89%8D%E8%83%BD%E5%81%9A%E5%88%B0%E4%BB%A3%E7%A0%81%E6%96%87%E6%A1%A3%E4%B8%80%E4%BD%93/" data-id="clp952vdr0008m4k5baf00vel" data-title="文档-如何才能做到代码文档一体" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Keycloak部署以及简单RBAC应用" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/05/20/Keycloak%E9%83%A8%E7%BD%B2%E4%BB%A5%E5%8F%8A%E7%AE%80%E5%8D%95RBAC%E5%BA%94%E7%94%A8/" class="article-date">
  <time class="dt-published" datetime="2020-05-20T03:38:19.000Z" itemprop="datePublished">2020-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/05/20/Keycloak%E9%83%A8%E7%BD%B2%E4%BB%A5%E5%8F%8A%E7%AE%80%E5%8D%95RBAC%E5%BA%94%E7%94%A8/">Keycloak部署以及简单RBAC应用</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>企业级应用中，总需要一个统一的登陆。之前是apero&#x2F;cas，现在有开箱即用的Keycloak</p>
<p>1、部署Keycloak（这里仅介绍standalone部署）</p>
<p>1.1、下载keycloak8.0.2安装包</p>
<p><a target="_blank" rel="noopener" href="https://www.keycloak.org/archive/downloads-8.0.2.html">https://www.keycloak.org/archive/downloads-8.0.2.html</a></p>
<p><a target="_blank" rel="noopener" href="https://downloads.jboss.org/keycloak/8.0.2/keycloak-8.0.2.tar.gz">https://downloads.jboss.org/keycloak/8.0.2/keycloak-8.0.2.tar.gz</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">tar -zxf keycloak-8.0.2.tar.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>1.2、上传mariadb jdbc连接包 mariadb-java-client-2.6.0.jar到目录.&#x2F;keycloak-8.0.2&#x2F;modules&#x2F;system&#x2F;layers&#x2F;base&#x2F;org&#x2F;mariadb&#x2F;main</p>
<p>新建文件.&#x2F;keycloak-8.0.2&#x2F;modules&#x2F;system&#x2F;layers&#x2F;base&#x2F;org&#x2F;mariadb&#x2F;main&#x2F;module.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;module name=&quot;org.mariadb&quot; xmlns=&quot;urn:jboss:module:1.3&quot;&gt;</span><br><span class="line">    &lt;resources&gt;</span><br><span class="line">        &lt;resource-root path=&quot;mariadb-java-client-2.6.0.jar&quot;/&gt;</span><br><span class="line">    &lt;/resources&gt;</span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;module name=&quot;javax.api&quot;/&gt;</span><br><span class="line">        &lt;module name=&quot;javax.transaction.api&quot;/&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/module&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>1.3、修改配置文件.&#x2F;keycloak-8.0.2&#x2F;standalone&#x2F;configuration&#x2F;standalone.xml</p>
<p>找到&lt;datasources&gt;中的&lt;drivers&gt;配置，在其中h2配置之前添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;driver name=&quot;mariadb&quot; module=&quot;org.mariadb&quot;&gt;</span><br><span class="line">    &lt;xa-datasource-class&gt;org.mariadb.jdbc.MariaDbDataSource&lt;/xa-datasource-class&gt;</span><br><span class="line">&lt;/driver&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>往上翻一翻&lt;datasources&gt;中有&lt;datasource jndi-name&#x3D;”java:jboss&#x2F;datasources&#x2F;KeycloakDS”&gt;的配置，修改为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;datasource jndi-name=&quot;java:jboss/datasources/KeycloakDS&quot; pool-name=&quot;KeycloakDS&quot; enabled=&quot;true&quot; use-java-context=&quot;true&quot; statistics-enabled=&quot;$&#123;wildfly.datasources.statistics-enabled:$&#123;wildfly.statistics-enabled:false&#125;&#125;&quot;&gt;</span><br><span class="line">    &lt;connection-url&gt;jdbc:mariadb://localhost:3306/keycloak&lt;/connection-url&gt;</span><br><span class="line">    &lt;driver&gt;mariadb&lt;/driver&gt;</span><br><span class="line">    &lt;security&gt;</span><br><span class="line">        &lt;user-name&gt;$user-name$&lt;/user-name&gt;</span><br><span class="line">        &lt;password&gt;$password$&lt;/password&gt;</span><br><span class="line">    &lt;/security&gt;</span><br><span class="line">&lt;/datasource&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>1.4、登陆mariadb并创建库 keycloak</p>
<p>并检查mariadb配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">wait_timeout=10000</span><br><span class="line">interactive_timeout=10000</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>1.5、配置keycloak启动参数.&#x2F;keycloak-8.0.2&#x2F;bin&#x2F;standalone.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#KeyCloak管理控制台绑定IP</span><br><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -Djboss.bind.address.management=0.0.0.0&quot;</span><br><span class="line">#KeyCloak绑定IP</span><br><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -Djboss.bind.address=0.0.0.0&quot;</span><br><span class="line">#KeyCloak绑定端口</span><br><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -Djboss.http.port=8080&quot;</span><br><span class="line">#KeyCloak绑定SSL端口</span><br><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -Djboss.https.port=8443&quot;</span><br><span class="line">#Jboss容器管理控制台绑定端口</span><br><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -Djboss.management.http.port=9990&quot;</span><br><span class="line">#Jboss容器管理控制台绑定SSL端口</span><br><span class="line">JAVA_OPTS=&quot;$JAVA_OPTS -Djboss.management.https.port=9993&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>1.6、启动keycloak</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">./keycloak-8.0.2/bin/standalone.sh </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>1.7、初始化Keycloak管理用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">./bin/add-user-keycloak.sh -u admin</span><br><span class="line"></span><br><span class="line">#do next</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>1.8、重启Keycloak</p>
<p>2、使用Keycloak认证（RBAC体系）</p>
<p>2.1、访问keycloak管理控制台</p>
<p>访问keycloak管理控制台：https:&#x2F;&#x2F;{ip:ssl-port}&#x2F;</p>
<p>使用admin用户名密码进入Administration Console</p>
<p>为了方便，可以在Master realm中修改theme，启用国际化并设置默认语言为zh-CN，然后修改admin用户语言环境为zh-CN</p>
<p>重新登陆admin用户</p>
<p>2.2、创建新域（realm）test，并切换成test域</p>
<p>2.3、添加组（group）实现部门管理</p>
<p>2.4、添加角色（role）实现角色管理</p>
<p>2.5、创建新客户端（client）test-client</p>
<p>2.6、进入test-client</p>
<p>添加客户端下的角色实现细粒度权限管理</p>
<p>添加新的有效重定向URI</p>
<p>比如支持本地调试 <a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080/</a>*</p>
<p>添加Web-Origin（实现http跨域）: *</p>
<p>2.7、添加用户user</p>
<p>添加用户user的凭据（密码）</p>
<p>角色映射中可以关联角色和客户端角色（角色&#x2F;权限）</p>
<p>组可以把用户加入某个分组（归属部门）</p>
<p>2.8、SpringBoot程序添加Keycloak进行安全认证和鉴权</p>
<p>pom.xml添加依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.keycloak&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;keycloak-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;8.0.2&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>配置Bean</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">public KeycloakSpringBootConfigResolver keycloakSpringBootConfigResolver() &#123;</span><br><span class="line">    return new KeycloakSpringBootConfigResolver();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>配置Keycloak安全拦截代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public class SecurityConfiguration extends KeycloakWebSecurityConfigurerAdapter &#123;</span><br><span class="line">    public SecurityConfiguration() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    public void configureGlobal(AuthenticationManagerBuilder auth) throws Exception &#123;</span><br><span class="line">        KeycloakAuthenticationProvider keycloakAuthenticationProvider = this.keycloakAuthenticationProvider();</span><br><span class="line">        SimpleAuthorityMapper grantedAuthorityMapper = new SimpleAuthorityMapper();</span><br><span class="line">        grantedAuthorityMapper.setConvertToLowerCase(true);</span><br><span class="line">        grantedAuthorityMapper.setPrefix(&quot;&quot;);</span><br><span class="line">        keycloakAuthenticationProvider.setGrantedAuthoritiesMapper(grantedAuthorityMapper);</span><br><span class="line">        auth.authenticationProvider(keycloakAuthenticationProvider);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public SessionAuthenticationStrategy sessionAuthenticationStrategy() &#123;</span><br><span class="line">        return new NullAuthenticatedSessionStrategy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected void configure(HttpSecurity http) throws Exception &#123;</span><br><span class="line">        super.configure(http);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>配置application.yml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">keycloak:</span><br><span class="line">  enabled: true</span><br><span class="line">  disable-trust-manager: true</span><br><span class="line">  auth-server-url: https://&#123;ip:ssl-port&#125;/auth</span><br><span class="line">  realm: test</span><br><span class="line">  resource: test-client</span><br><span class="line">  ssl-required: none</span><br><span class="line">  public-client: true</span><br><span class="line">  bearer-only: false</span><br><span class="line">  use-resource-role-mappings: true</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mosence.github.io/2020/05/20/Keycloak%E9%83%A8%E7%BD%B2%E4%BB%A5%E5%8F%8A%E7%AE%80%E5%8D%95RBAC%E5%BA%94%E7%94%A8/" data-id="clp952vdi0001m4k5hypr0se5" data-title="Keycloak部署以及简单RBAC应用" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-docker-springboot" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/15/docker-springboot/" class="article-date">
  <time class="dt-published" datetime="2019-05-15T00:56:59.000Z" itemprop="datePublished">2019-05-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/15/docker-springboot/">【转】docker 部署 springboot</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Maven-Docker-部署"><a href="#Maven-Docker-部署" class="headerlink" title="Maven+Docker 部署"></a>Maven+Docker 部署</h1><h2 id="安装jdk8镜像"><a href="#安装jdk8镜像" class="headerlink" title="安装jdk8镜像"></a>安装jdk8镜像</h2><blockquote>
<p>docker pull openjdk:8-jdk-alpine</p>
</blockquote>
<h2 id="maven插件推送方式"><a href="#maven插件推送方式" class="headerlink" title="maven插件推送方式"></a>maven插件推送方式</h2><ol>
<li>修改&#x2F;etc&#x2F;docker&#x2F;daemon.json文件，加入hosts配置即可。 注意 使用本地docker构建，不要用的生产服务器上，这种方式容易被别人注入木马<br>本地局域网 192.168.10.222</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">&quot;hosts&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="string">&quot;tcp://0.0.0.0:2375&quot;</span><span class="punctuation">,</span><span class="string">&quot;unix:///var/run/docker.sock&quot;</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<ol>
<li>在settings.xml文件的同级目录创建settings-security.xml文件<br>在cmd命令行中使用，在bash中特殊字符会出现转义问题<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mvn --encrypt-master-password &lt;password&gt;</span><br><span class="line">&#123;4Cmy61mOMasHCreAdBngs40S7FJ8dFcD8MG9jCJKSNA=&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;settingsSecurity&gt;</span><br><span class="line">  &lt;master&gt;&#123;4Cmy61mOMasHCreAdBngs40S7FJ8dFcD8MG9jCJKSNA=&#125;&lt;/master&gt;</span><br><span class="line">&lt;/settingsSecurity&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>编辑settings.xml<br>最后使用你的私有仓库访问密码生成服务密码，将生成的密码写入到settings.xml的</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mvn --encrypt-password &lt;password&gt;</span><br><span class="line">&#123;RCeI2AmEXXgHmFttKbzhhXBLq/vQdczAluUl3Vd7tsg=&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;server&gt;</span><br><span class="line">		&lt;id&gt;docker-aliyun&lt;/id&gt;</span><br><span class="line">		&lt;username&gt;matosiki@163.com&lt;/username&gt;</span><br><span class="line">		&lt;password&gt;&#123;RCeI2AmEXXgHmFttKbzhhXBLq/vQdczAluUl3Vd7tsg=&#125;&lt;/password&gt;</span><br><span class="line">		&lt;configuration&gt;</span><br><span class="line">			&lt;email&gt;matosiki@163.com&lt;/email&gt;</span><br><span class="line">		&lt;/configuration&gt;</span><br><span class="line">	&lt;/server&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">2. 重新加载配置文件，并重启docker</span><br><span class="line"></span><br><span class="line">&gt; systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">&gt; systemctl restart docker</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3. 验证，直接访问：</span><br><span class="line"></span><br><span class="line">&gt; curl 127.0.0.1:2375/info</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">## java项目</span><br><span class="line"></span><br><span class="line">1. maven pom.xm 配置文件</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;build&gt;</span><br><span class="line"></span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- springboot打包 --&gt;</span><br><span class="line"></span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line"></span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line"></span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line"></span><br><span class="line">             </span><br><span class="line"></span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line"></span><br><span class="line">                &lt;groupId&gt;com.spotify&lt;/groupId&gt;</span><br><span class="line"></span><br><span class="line">                &lt;artifactId&gt;docker-maven-plugin&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">                &lt;version&gt;0.4.9&lt;/version&gt;</span><br><span class="line"></span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line"></span><br><span class="line">                   &lt;!-- 镜像名称  --&gt;</span><br><span class="line"></span><br><span class="line">                   &lt;imageName&gt;matosiki/springboot-docker-demo&lt;/imageName&gt;</span><br><span class="line"></span><br><span class="line">                   &lt;!-- docker远程服务器地址 --&gt;</span><br><span class="line"></span><br><span class="line">                   &lt;dockerHost&gt;http://服务器IP:2375&lt;/dockerHost&gt;</span><br><span class="line"></span><br><span class="line">                   &lt;!-- Dockerfile文件存放目录 --&gt;</span><br><span class="line"></span><br><span class="line">                   &lt;dockerDirectory&gt;src/main/docker&lt;/dockerDirectory&gt;</span><br><span class="line"></span><br><span class="line">                   &lt;resources&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;resource&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;directory&gt;$&#123;project.build.directory&#125;&lt;/directory&gt;</span><br><span class="line"></span><br><span class="line">                        &lt;include&gt;$&#123;project.build.finalName&#125;.jar&lt;/include&gt;</span><br><span class="line"></span><br><span class="line">                    &lt;/resource&gt;</span><br><span class="line"></span><br><span class="line">                &lt;/resources&gt;</span><br><span class="line"></span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line"></span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/build&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>编写Dockerfile 文件</li>
</ol>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dockerfile</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 基于的镜像</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">8</span>-jdk-alpine</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装字体，Captcha需要字体支持</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">set</span> -xe &amp;&amp; apk --no-cache add ttf-dejavu fontconfig</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash"> /opt/tmp</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> projectname-1.0.0-SNAPSHOT.jar app.jar</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment"># -Djava.security.egd=file:/dev/./urandom 可解决tomcat可能启动慢的问题</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具体可查看：https://www.cnblogs.com/mightyvincent/p/7685310.html</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-Djava.security.egd=file:/dev/./urandom&quot;</span>,<span class="string">&quot;-jar&quot;</span>,<span class="string">&quot;/app.jar&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="comment"># 对外端口</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>编码运行</li>
</ol>
<blockquote>
<p>mvn clean package docker:build -Dmaven.test.skip&#x3D;true</p>
</blockquote>
<ol start="4">
<li>查看镜像</li>
</ol>
<blockquote>
<p>docker images</p>
</blockquote>
<ol start="5">
<li>运行镜像，查看是否启动正常</li>
</ol>
<blockquote>
<p>docker run -d -p 8080:8080 matosiki&#x2F;springboot-docker-demo</p>
</blockquote>
<ol start="6">
<li>基于已有镜像运行 jar</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 1234:8080 -v /opt/docker/projectname-1.0.0-SNAPSHOT.jar:/usr/projectname-1.0.0-SNAPSHOT.jar --name SpringbootByJar openjdk:8-jdk-alpine java -jar /usr/projectname-1.0.0-SNAPSHOT.jar</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://mosence.github.io/2019/05/15/docker-springboot/" data-id="clp952vdm0003m4k5b9379aqk" data-title="【转】docker 部署 springboot" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-SpringBoot额外的jar" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/14/SpringBoot%E9%A2%9D%E5%A4%96%E7%9A%84jar/" class="article-date">
  <time class="dt-published" datetime="2019-05-14T06:20:11.000Z" itemprop="datePublished">2019-05-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/14/SpringBoot%E9%A2%9D%E5%A4%96%E7%9A%84jar/">SpringBoot额外的jar</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#executable-jar-launching">SpringBoot Doc</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/maven-plugin/">SpringBoot plugin</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- pom.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span>&gt;</span>ZIP<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ZIP (alias to DIR): similar to the JAR layout using PropertiesLauncher.<br>使用 PropertiesLauncher 启动。</p>
<p>经过读代码分析，默认的 Jar layout 使用的 JarLauncher 无法引入外部 jar，只有使用 PropertiesLauncher 才可以通过配置 loader.path 去指定外部 jar 路径引入。</p>
<p>注：PropertiesLauncher 在 SpringBootLoader 中。<a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-tools/spring-boot-loader/src/main/java/org/springframework/boot/loader/PropertiesLauncher.java">github</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mosence.github.io/2019/05/14/SpringBoot%E9%A2%9D%E5%A4%96%E7%9A%84jar/" data-id="clp952vdk0002m4k55wlr0k4a" data-title="SpringBoot额外的jar" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-flinkx简易用法" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/10/flinkx%E7%AE%80%E6%98%93%E7%94%A8%E6%B3%95/" class="article-date">
  <time class="dt-published" datetime="2019-05-10T01:34:00.000Z" itemprop="datePublished">2019-05-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/10/flinkx%E7%AE%80%E6%98%93%E7%94%A8%E6%B3%95/">flinkx简易用法</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>flinkx 是基于 flinx为底层数据传输中间处理，进行input,output组件化的项目。</p>
<p>可以实现json配置一个简单数据流程，通过flinkx处理后提交由flink集群调用。</p>
<ul>
<li>部署</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/DTStack/flinkx">flinkx</a></p>
<p><a target="_blank" rel="noopener" href="https://flink.apache.org/">flink</a> </p>
<p>flinkx clone源码后通过maven编译，最终生成 flinkx 的 bin,lib,plugins</p>
<p>flink 按照文档一步一步下载运行就行了，集群间自动发现。</p>
<ul>
<li>使用</li>
</ul>
<p>简单调用如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/flinkx -job ./temp/sftp_to_sftp.json -plugin ./plugins</span><br></pre></td></tr></table></figure>

<p>sftp_to_sftp.json，一个简易的本地文件抽取，抽取文件并替换分隔符，添加处理标识。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;job&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;setting&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;speed&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;channel&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;errorLimit&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;record&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;percentage&quot;</span><span class="punctuation">:</span> <span class="number">0.02</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;reader&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ftpreader&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;parameter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sftp&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;localhost&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;root&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;column&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                            <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">                            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">                            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;value&quot;</span><span class="punctuation">:</span> <span class="string">&quot;isRead&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">                            <span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/data/flink/test/readData/&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;encoding&quot;</span><span class="punctuation">:</span> <span class="string">&quot;UTF-8&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;fieldDelimiter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\\t&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;writer&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ftpwriter&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;parameter&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;protocol&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sftp&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;localhost&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;username&quot;</span><span class="punctuation">:</span> <span class="string">&quot;root&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;writeMode&quot;</span><span class="punctuation">:</span> <span class="string">&quot;overwrite&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;/data/flink/test/writeData/&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;fieldDelimiter&quot;</span><span class="punctuation">:</span> <span class="string">&quot;,&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;column&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                            <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ID&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">                            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;NAME&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">                            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="punctuation">&#123;</span></span><br><span class="line">                                <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;STATUS&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;string&quot;</span></span><br><span class="line">                            <span class="punctuation">&#125;</span></span><br><span class="line">                        <span class="punctuation">]</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>&#x2F;data&#x2F;flink&#x2F;test&#x2F;readData&#x2F;test.txt</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1	NAME1</span><br><span class="line">2	NAME2</span><br></pre></td></tr></table></figure>

<p>最终生成结果 0.20190509143030.cb219e90-da3a-439b-b749-3f01b07a7930.csv</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1,NAME1,isRead</span><br><span class="line">2,NAME2,isRead</span><br></pre></td></tr></table></figure>

<p>问题1： 生成的结果默认是 .csv格式，并且名称重新定义了，不知道能不能可控？</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mosence.github.io/2019/05/10/flinkx%E7%AE%80%E6%98%93%E7%94%A8%E6%B3%95/" data-id="clp952vdn0004m4k54m2a6mj9" data-title="flinkx简易用法" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-java-嵌入式LDAP" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/04/24/java-%E5%B5%8C%E5%85%A5%E5%BC%8FLDAP/" class="article-date">
  <time class="dt-published" datetime="2019-04-24T01:34:00.000Z" itemprop="datePublished">2019-04-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/04/24/java-%E5%B5%8C%E5%85%A5%E5%BC%8FLDAP/">java 嵌入式LDAP</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>最近要用到LDAP来统一用户信息存储，当然选型最广泛使用的并且自身就有层级的LDAP来存储了，但是部署一个LDAP服务器还是挺麻烦的，于是找了spring体系下就支持的嵌入式内存LDAP。</p>
<p>直接上代码好了，以下依次是依赖、配置、数据预定义存储文件、Entry类、Repository类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.unboundid&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;unboundid-ldapsdk&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#application.yaml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">ldap:</span></span><br><span class="line">    <span class="attr">embedded:</span></span><br><span class="line">      <span class="attr">base-dn:</span> <span class="string">dc=mdp,dc=mosence,dc=org</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8888</span></span><br></pre></td></tr></table></figure>
<p>schema.ldif</p>
<figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">dn</span>: dc=mdp,dc=mosence,dc=org</span><br><span class="line"><span class="attribute">objectClass</span>: top</span><br><span class="line"><span class="attribute">objectClass</span>: domain</span><br><span class="line"><span class="attribute">dc</span>: mdp</span><br><span class="line"></span><br><span class="line"><span class="attribute">dn</span>: dc=account,dc=mdp,dc=mosence,dc=org</span><br><span class="line"><span class="attribute">objectClass</span>: top</span><br><span class="line"><span class="attribute">objectClass</span>: domain</span><br><span class="line"><span class="attribute">dc</span>: account</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Account.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Account.java */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entry(base = &quot;dc=account,dc=mdp,dc=mosence,dc=org&quot;,objectClasses = &quot;person&quot;)</span> <span class="comment">//ldif中必须定义top，否则报错</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> <span class="keyword">implements</span> <span class="title class_">UserDetails</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Name oid;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Attribute(name=&quot;cn&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DnAttribute(value = &quot;sn&quot;,index = 4)</span> <span class="comment">//这里的index表示，在entry实例中，dn标识从右到左第几个标识，并且在一个entry中必须最少一个index&gt;=0的@DnAttribute</span></span><br><span class="line">    <span class="meta">@Attribute(name=&quot;sn&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@org</span>.codehaus.jackson.annotate.JsonIgnore</span><br><span class="line">    <span class="meta">@com</span>.fasterxml.jackson.annotation.JsonIgnore</span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> String password; <span class="comment">//因为objectClasses = &quot;person&quot;中，userPassword必须是BINARY类型，所以这里这么搞</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span>&#123; <span class="comment">//因为objectClasses = &quot;person&quot;中，userPassword必须是BINARY类型，所以这里这么搞</span></span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">        <span class="built_in">this</span>.bytesPassword = <span class="built_in">this</span>.password.getBytes();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPassword</span><span class="params">()</span>&#123; <span class="comment">//因为objectClasses = &quot;person&quot;中，userPassword必须是BINARY类型，所以这里这么搞</span></span><br><span class="line">        <span class="built_in">this</span>.password = <span class="keyword">new</span> <span class="title class_">String</span>(<span class="built_in">this</span>.bytesPassword);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Attribute(name = &quot;userPassword&quot;, type = Attribute.Type.BINARY)</span></span><br><span class="line">    <span class="meta">@org</span>.codehaus.jackson.annotate.JsonIgnore</span><br><span class="line">    <span class="meta">@com</span>.fasterxml.jackson.annotation.JsonIgnore</span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] bytesPassword; <span class="comment">//因为objectClasses = &quot;person&quot;中，userPassword必须是BINARY类型，所以这里这么搞</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUsername</span><span class="params">(String username)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.id = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">enabled</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">delete</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transient</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">expired</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (expired==-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAccountNonLocked</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> !lock;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isCredentialsNonExpired</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (expired==-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> enabled;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* AccountRepository.java */</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountRepository</span> <span class="keyword">extends</span> <span class="title class_">LdapRepository</span>&lt;Account&gt; &#123;</span><br><span class="line">    Optional&lt;Account&gt; <span class="title function_">findByUsername</span><span class="params">(String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>没有实例代码哦，愉快的玩耍吧，反正理解 LDAP 的协议规范后还是很简单，这里就不介绍 LDAP 规范了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mosence.github.io/2019/04/24/java-%E5%B5%8C%E5%85%A5%E5%BC%8FLDAP/" data-id="clp952vdp0006m4k58sn7dy3v" data-title="java 嵌入式LDAP" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-开源N步，如何提交maven中央仓库" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/04/09/%E5%BC%80%E6%BA%90N%E6%AD%A5%EF%BC%8C%E5%A6%82%E4%BD%95%E6%8F%90%E4%BA%A4maven%E4%B8%AD%E5%A4%AE%E4%BB%93%E5%BA%93/" class="article-date">
  <time class="dt-published" datetime="2019-04-09T01:30:54.000Z" itemprop="datePublished">2019-04-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/04/09/%E5%BC%80%E6%BA%90N%E6%AD%A5%EF%BC%8C%E5%A6%82%E4%BD%95%E6%8F%90%E4%BA%A4maven%E4%B8%AD%E5%A4%AE%E4%BB%93%E5%BA%93/">开源N步，如何提交maven中央仓库</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Apache Maven 是源码管理和工程构建工具，我们也习惯了如何从中央仓库中通过groupId和artifactId去管理自己的项目依赖。</p>
<p>在公司，我们可能也习惯使用公司私有的maven仓库去发布我们的源码包，但是如何去把我们的开源项目包提交中央仓库以提供更多使用者呢？</p>
<p>首先，需要了解中央仓库是什么组织在管理的</p>
<p><a target="_blank" rel="noopener" href="https://www.sonatype.com/">sonatype</a></p>
<p><a target="_blank" rel="noopener" href="https://help.sonatype.com/docs">sonatype document</a></p>
<p><a target="_blank" rel="noopener" href="https://issues.sonatype.org/">sonatype jira</a></p>
<p>所以，我们要提交开源包中央仓库就需要sonatype的账户</p>
<p>去<a target="_blank" rel="noopener" href="https://issues.sonatype.org/">sonatype项目管理工具</a>中申请账户，然后创建一个自己的项目</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Project 选择Community Support</span><br><span class="line"></span><br><span class="line">Issue Type 选择New Project</span><br><span class="line"></span><br><span class="line">Summary 填上项目名称</span><br><span class="line"></span><br><span class="line">Description 填写项目描述</span><br><span class="line"></span><br><span class="line">Group Id 填写项目的groupId，规则需要按照 [中央仓库GroupId规则](http://central.sonatype.org/pages/choosing-your-coordinates.html)</span><br><span class="line"></span><br><span class="line">Project URL 填写项目的地址</span><br><span class="line"></span><br><span class="line">SCM url 填写项目的源码管理地址，如github管理的就填写github项目地址</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>以上是一个新Project必要的字段，如没有，则需要Configure Fields中勾选相应的字段。</p>
<p>提交新项目申请后会有负责人审核项目，审核过程会用邮件告知</p>
<p>审核成功后该 Issue 状态会变更成 RESOLVED 状态，Comments中也会提醒你如何去处理。</p>
<p>接下来就是如同发布到私有库中的流程一样了，只不过中央库更加严格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">首先pom中需要声明项目地址如：&lt;url&gt;https://github.com/mosence/xxx&lt;/url&gt;</span><br><span class="line"></span><br><span class="line">也需要声明开源协议如Apache开源协议</span><br><span class="line">&lt;licenses&gt;</span><br><span class="line">    &lt;license&gt;</span><br><span class="line">        &lt;name&gt;The Apache License, Version 2.0&lt;/name&gt;</span><br><span class="line">        &lt;url&gt;http://www.apache.org/licenses/LICENSE-2.0.txt&lt;/url&gt;</span><br><span class="line">    &lt;/license&gt;</span><br><span class="line">&lt;/licenses&gt;</span><br><span class="line"></span><br><span class="line">开发者信息</span><br><span class="line">&lt;developers&gt;</span><br><span class="line">    &lt;developer&gt;</span><br><span class="line">        &lt;name&gt;mosence&lt;/name&gt;</span><br><span class="line">        &lt;email&gt;mosence@gmail.com&lt;/email&gt;</span><br><span class="line">    &lt;/developer&gt;</span><br><span class="line">&lt;/developers&gt;</span><br><span class="line"></span><br><span class="line">项目源码管理地址</span><br><span class="line">&lt;scm&gt;</span><br><span class="line">    &lt;connection&gt;scm:git:https://github.com/mosence/xxx.git&lt;/connection&gt;</span><br><span class="line">    &lt;developerConnection&gt;scm:git:https://github.com/mosence/xxx.git&lt;/developerConnection&gt;</span><br><span class="line">    &lt;url&gt;https://github.com/mosence/xxx&lt;/url&gt;</span><br><span class="line">    &lt;tag&gt;v0.0.1&lt;/tag&gt;</span><br><span class="line">&lt;/scm&gt;</span><br><span class="line"></span><br><span class="line">发布管理中依照Comments中的提醒去添加发布地址</span><br><span class="line">&lt;distributionManagement&gt;</span><br><span class="line">    &lt;snapshotRepository&gt;</span><br><span class="line">        &lt;id&gt;sonatype&lt;/id&gt;</span><br><span class="line">        &lt;url&gt;https://oss.sonatype.org/content/repositories/snapshots&lt;/url&gt;</span><br><span class="line">    &lt;/snapshotRepository&gt;</span><br><span class="line">    &lt;repository&gt;</span><br><span class="line">        &lt;id&gt;sonatype&lt;/id&gt;</span><br><span class="line">        &lt;url&gt;https://oss.sonatype.org/service/local/staging/deploy/maven2/&lt;/url&gt;</span><br><span class="line">    &lt;/repository&gt;</span><br><span class="line">&lt;/distributionManagement&gt;</span><br><span class="line"></span><br><span class="line">插件中需要添加maven-release-plugin、maven-source-plugin、maven-javadoc-plugin来进行发布、源码发布、javadoc发布</span><br><span class="line"></span><br><span class="line">nexus-staging-maven-plugin来配置提交规范</span><br><span class="line"></span><br><span class="line">maven-gpg-plugin来对发布包进行gpg签名</span><br><span class="line"></span><br><span class="line">相应的插件用法就不详细介绍了</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后通过 mvn deploy 去发布你的开源包</p>
<p>最后提醒一下版本号，-SNAPSHOT后缀会发布到快照版本库中，其他后缀发布在正式版本库中，正式版本库是没法覆盖删除的，请注意！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mosence.github.io/2019/04/09/%E5%BC%80%E6%BA%90N%E6%AD%A5%EF%BC%8C%E5%A6%82%E4%BD%95%E6%8F%90%E4%BA%A4maven%E4%B8%AD%E5%A4%AE%E4%BB%93%E5%BA%93/" data-id="clp952vdq0007m4k56vbg6npm" data-title="开源N步，如何提交maven中央仓库" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-SpringBootAdmin中集成SwaggerApi" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/04/01/SpringBootAdmin%E4%B8%AD%E9%9B%86%E6%88%90SwaggerApi/" class="article-date">
  <time class="dt-published" datetime="2019-04-01T03:45:57.000Z" itemprop="datePublished">2019-04-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/04/01/SpringBootAdmin%E4%B8%AD%E9%9B%86%E6%88%90SwaggerApi/">SpringBootAdmin中集成SwaggerApi</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在使用SpringBoot以及SpringCloud搭建微服务时，我们可能会用SpringBootAdmin去监控各个服务。</p>
<p>另外我们还会使用Springfox-Swagger去生成Swagger文档，那么可以把Swagger文档集成到SpringBootAdmin。</p>
<p>首先，SpringBootAdmin监听&#x2F;api-docs端点，在相应配置中添加&#x2F;api-docs</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">boot:</span></span><br><span class="line">    <span class="attr">admin:</span></span><br><span class="line">	  <span class="attr">probed-endpoints:</span> <span class="string">api-docs,health,env,metrics,httptrace:trace,threaddump:dump,jolokia,info,logfile,refresh,flyway,liquibase,heapdump,loggers,auditevents</span></span><br></pre></td></tr></table></figure>

<p>然后，创建一个vuejs项目去扩展SpringBootAdmin功能，如：<br><a target="_blank" rel="noopener" href="https://github.com/mosence/spring-boot-admin-swagger-view">spring-boot-admin-swagger-view</a></p>
<p>maven打成jar包后引入SpringBootAdmin项目或者npm打包后把dist目录文件copy到&#x2F;reousrces&#x2F;META-INF&#x2F;spring-boot-admin-server-ui&#x2F;extensious&#x2F;api-docs</p>
<p>接着在各个服务开放&#x2F;api-docs端点，在SpringBoot 2.X中，访问路径为&#x2F;actuator&#x2F;api-docs，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Endpoint(id = &quot;api-docs&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletSwaggerApiEndpoint</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> HttpServletRequest servletRequest;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DocumentationCache documentationCache;</span><br><span class="line">    <span class="keyword">private</span> ServiceModelToSwagger2Mapper mapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ServletSwaggerApiEndpoint</span><span class="params">(DocumentationCache documentationCache,</span></span><br><span class="line"><span class="params">                                      ServiceModelToSwagger2Mapper mapper)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.documentationCache = documentationCache;</span><br><span class="line">        <span class="built_in">this</span>.mapper = mapper;</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@ReadOperation(produces = &quot;application/json&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Swagger <span class="title function_">loadApiDocs</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">groupName</span> <span class="operator">=</span> Docket.DEFAULT_GROUP_NAME;</span><br><span class="line">        <span class="type">Documentation</span> <span class="variable">documentation</span> <span class="operator">=</span> documentationCache.documentationByGroup(groupName);</span><br><span class="line">        <span class="type">Swagger</span> <span class="variable">swagger</span> <span class="operator">=</span> mapper.mapDocumentation(documentation);</span><br><span class="line"></span><br><span class="line">        <span class="type">UriComponents</span> <span class="variable">uriComponents</span> <span class="operator">=</span> componentsFrom(servletRequest, swagger.getBasePath());</span><br><span class="line">        swagger.basePath(Strings.isNullOrEmpty(uriComponents.getPath()) ? <span class="string">&quot;/&quot;</span> : uriComponents.getPath());</span><br><span class="line">        swagger.setHost(uriComponents.getHost()+ <span class="string">&quot;:&quot;</span> +uriComponents.getPort());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> swagger;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>服务被SpringBootAdmin发现后就可以在服务实例中看到Api-Docs啦！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://mosence.github.io/2019/04/01/SpringBootAdmin%E4%B8%AD%E9%9B%86%E6%88%90SwaggerApi/" data-id="clp952vd50000m4k5bjzud1s9" data-title="SpringBootAdmin中集成SwaggerApi" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">十一月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">五月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">四月 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/11/22/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2023/11/22/%E6%96%87%E6%A1%A3-%E5%A6%82%E4%BD%95%E6%89%8D%E8%83%BD%E5%81%9A%E5%88%B0%E4%BB%A3%E7%A0%81%E6%96%87%E6%A1%A3%E4%B8%80%E4%BD%93/">文档-如何才能做到代码文档一体</a>
          </li>
        
          <li>
            <a href="/2020/05/20/Keycloak%E9%83%A8%E7%BD%B2%E4%BB%A5%E5%8F%8A%E7%AE%80%E5%8D%95RBAC%E5%BA%94%E7%94%A8/">Keycloak部署以及简单RBAC应用</a>
          </li>
        
          <li>
            <a href="/2019/05/15/docker-springboot/">【转】docker 部署 springboot</a>
          </li>
        
          <li>
            <a href="/2019/05/14/SpringBoot%E9%A2%9D%E5%A4%96%E7%9A%84jar/">SpringBoot额外的jar</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 MoSence<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>